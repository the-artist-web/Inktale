<% 
    const {
        userAuthenticated,
        name,
        username,
        profilePhoto
    } = locals.sessionUser || {};

    const compressedProfilePhotoURL = profilePhoto?.replace("upload/", "upload/w_40,h_40,c_auto/q_auto/f_auto/");
%>

<header class="top-app-bar" data-top-app-bar>
    <% if (locals.route === "/createblog") { %>
        <button class="icon-btn filled-tonal" data-back-btn>
            <i class="fa-solid fa-chevron-left"></i>

            <div class="state-player"></div>
        </button>
    <% }; %>

    <a href="/" class="logo">
        <img 
            src="/images/logo-light.svg"
            alt="Inktale"
            width="98" 
            height="24" 
            loading="lazy"
            class="light"
        />

        <img 
            src="/images/logo-dark.svg"
            alt="Inktale"
            width="98" 
            height="24" 
            loading="lazy"
            class="dark"
        />
    </a>

    <div class="trailing-action-wrapper">
        <% if (userAuthenticated) { %>
            <% if (locals.route !== "/createblog") { %>
                <a href="/createblog" class="btn btn-fill">
                    <i class="fa-solid fa-pen"></i>

                    <p class="label-large">Write</p>

                    <div class="state-layer"></div>
                </a>
            <% }; %>

            <div class="menu-wrapper" data-menu-wrapper>
                <button class="icon-btn" data-menu-toggler>
                    <div class="avatar">
                        <% if (compressedProfilePhotoURL) { %>
                            <img 
                                src="<%= compressedProfilePhotoURL %>" 
                                alt="<%= name %>"
                                width="40"
                                height="40"
                                loading="lazy"
                                class="img-cover"
                            />
                        <% } else { %>
                            <p class="title-medium">
                                <%= name.charAt(0) %>
                            </p>
                        <% }; %>
                    </div>

                    <div class="state-layer"></div>
                </button>

                <div class="menu" data-menu>
                    <div class="list-item small">
                        <div class="avatar">
                            <% if (compressedProfilePhotoURL) { %>
                                <img 
                                    src="<%= compressedProfilePhotoURL %>" 
                                    alt="<%= name %>"
                                    width="40"
                                    height="40"
                                    loading="lazy"
                                    class="img-cover"
                                />
                            <% } else { %>
                                <p class="title-medium">
                                    <%= name.charAt(0) %>
                                </p>
                            <% }; %>
                        </div>

                        <div>
                            <p class="label-small text-primary truncate-oneline">
                                <%= username %>
                            </p>

                            <p class="body-large text-on-surface">
                                <%= name %>
                            </p>
                        </div>

                        <div class="state-layer"></div>

                        <a href="/profile/<%= username %>" title="<%= name %>" class="list-item-link"></a>
                    </div>

                    <div class="divider"></div>

                    <a href="/dashboard" class="menu-item">
                        <i class="fas fa-tachometer-alt"></i>

                        <p class="label-large">Dashboard</p>

                        <div class="state-layer"></div>
                    </a>

                    <a href="/redinglist" class="menu-item">
                        <i class="fa-solid fa-bookmark"></i>

                        <p class="label-large">Reading list</p>

                        <div class="state-layer"></div>
                    </a>

                    <a href="/settings" class="menu-item">
                        <i class="fa-solid fa-gear"></i>

                        <p class="label-large">Settings</p>

                        <div class="state-layer"></div>
                    </a>

                    <div class="divider"></div>

                    <form action="/logout" method="post">
                        <button type="submit" class="menu-item">
                            <i class="fa-solid fa-arrow-right-from-bracket"></i>

                            <p class="label-large">Sign out</p>
        
                            <div class="state-layer"></div>
                        </button>
                    </form>
                </div>
            </div>
        <% } else { %>
            <a href="/login" class="btn btn-text">
                <p class="label-large">Login</p>

                <div class="state-layer"></div>
            </a>

            <a href="/register" class="btn btn-fill">
                <p class="label-large">Create account</p>

                <div class="state-layer"></div>
            </a>
        <% }; %>
    </div>

    <!-- #PROGRESS BAR -->
    <div class="porgress-bar" data-porgress-bar>
        <div class="progress-active-indicator"></div>
        <div class="progress-track"></div>
    </div>
</header>